/*!18-09-2014 */
(function(){window.Cetabo||(window.Cetabo={}),window.google||(window.google={}),google.maps||(google.maps={}),Cetabo.Api={maps:[],create:function(a,b){var c;return null!=b&&(b="map"+Math.floor(1e5*Math.random())),c=new Cetabo.MapView(a),this.maps[b]=c,c.loadModel(a.id),c}}}).call(this),function(){Cetabo.ArrayUtil={has:function(a,b){var c;for(c=0;c<a.length;){if(a[c]===b)return!0;c++}return!1},removeByPosition:function(a,b,c){var d;return void 0===b||void 0===c?a:(d=a.slice((c||b)+1||a.length),a.length=0>b?a.length+b:b,a.push.apply(a,d))},removeByContent:function(a,b){var c;for(c=0;c<a.length;)a[c]===b&&Cetabo.ArrayUtil.removeByPosition(a,c,c),c++},asSet:function(a){var b,c,d;for(d=[],b=0,c=a.length;c>b;)-1===d.indexOf(a[b])&&d.push(a[b]),b++;return d},pushArray:function(a,b){var c,d;for(c=0,d=b.length;d>c;)a.push(b[c]),++c}},Cetabo.StringUtil={replaceAll:function(a,b,c){return a.replace(new RegExp(b,"g"),c)},trim:function(a,b){return a.rtrim(b).ltrim(b)},ltrim:function(a,b){return b=b||"\\s",a.replace(new RegExp("^["+b+"]+","g"),"")},rtrim:function(a,b){return b=b||"\\s",a.replace(new RegExp("["+b+"]+$","g"),"")},isEmpty:function(a){return void 0===a||null===a||""===a.trim()}}}.call(this),function(){Cetabo.EventDistpatcher={channels:[],use:function(a){return void 0===this.channels[a]&&(this.channels[a]=_.extend({},Backbone.Events)),this.channels[a]}}}.call(this),function(){Cetabo.BaseManager=Backbone.Model.extend({})}.call(this),function(){Cetabo.NotificationsManager=Cetabo.BaseManager.extend({constructor:function(a){var b;b=a.channel,this.config=jQuery.extend({el:"#notification"},a),Cetabo.EventDistpatcher.use(b).on("notification.show",this.show,this)},show:function(a){jQuery(this.config.el).html(a).fadeIn(500).delay(4e3).fadeOut()}})}.call(this),function(){Cetabo.OverlayManager=Cetabo.BaseManager.extend({constructor:function(a){var b;b=a.channel,this.config=jQuery.extend({el:"#cmap-overlay"},a),Cetabo.EventDistpatcher.use(b).on("overlay.show",this.show,this),Cetabo.EventDistpatcher.use(b).on("overlay.hide",this.hide,this)},show:function(){jQuery(this.config.el).modal("show")},hide:function(){jQuery(this.config.el).modal("hide")}})}.call(this),function(){Cetabo.TemplateManager={template:{},registerHelpersIfRequired:function(){return null==this.inited?(this.inited=!0,Handlebars.registerHelper("list",function(a,b){var c,d;for(d="",c=0;c<a.length;)d+=b.fn(a[c]),c++;return d})):void 0},getTemplateByName:function(a){return this.registerHelpersIfRequired(),void 0===this.template[a]&&(this.template[a]=Handlebars.compile(jQuery(a).html())),this.template[a]}}}.call(this),function(){Cetabo.ConnectionManager=Cetabo.BaseManager.extend({constructor:function(a){var b;b=a.channel,Cetabo.EventDistpatcher.use(b).on("backend.send",this.send,this),this.config=a},send:function(a){var b,c;b=a.callback,c=a.url,jQuery.ajax({url:a.url,type:"POST",dataType:"json",data:a.content,success:function(a){void 0!==b&&b.success&&b.success(a)},error:function(a,c,d){void 0!==b&&b.error&&b.error(d)}})}})}.call(this),function(){Cetabo.MarkerManager=Cetabo.BaseManager.extend({initialize:function(){var a;a=this.get("channel"),this.set("state",{markers:{},infoViews:{}}),this.set("clustering",!1),Cetabo.EventDistpatcher.use(a).on("overlay.updated",this.onOverlayStateUpdated,this),Cetabo.EventDistpatcher.use(a).on("place.cluster",this.onClusteringStateUpdated,this),Cetabo.EventDistpatcher.use(a).on("place.add",this.onPlaceStateUpdated,this),Cetabo.EventDistpatcher.use(a).on("place.remove",this.onPlaceStateUpdated,this),Cetabo.EventDistpatcher.use(a).on("place.update",this.onPlaceStateUpdated,this),Cetabo.EventDistpatcher.use(a).on("place.filter",this.onPlaceFilter,this),Cetabo.EventDistpatcher.use(a).on("place.focus",this.onPlaceFocus,this),this.set("defaultoverlay",!0),this.set("overlaymultiple",!0)},addMarker:function(a,b){this.placeNewMarkerOnContainer(a),this.attachToContainer(a,b),this.bindEvents(a,b)},placeNewMarkerOnContainer:function(a){var b;void 0!==a.get("lat")&&void 0!==a.get("lng")||!this.isNewMarkerReferenceProvider()||(b=this.getNewMarlerReference(),a.set("lat",b.lat()),a.set("lng",b.lng()))},getNewMarlerReference:function(){},isNewMarkerReferenceProvider:function(){},getContainer:function(){},isAllowingClustering:function(){return!0},attachToContainer:function(a,b){var c,d,e;return c=a.get("locked")===!0,d=new google.maps.Marker({position:new google.maps.LatLng(a.get("lat"),a.get("lng")),map:b,draggable:!this.get("readonly")&&!c,title:a.get("name"),_refplace:a}),e=this,google.maps.event.addListener(d,"click",function(){var c,f;f=e.getPlaceInfoViewGroup(a,b),null==e.infoViewToOpen||e.get("overlaymultiple")||e.infoViewToOpen.close(),e.infoViewToOpen=e.selectInfoView(f),c=a.get("details"),c&&0!==c.length&&!/^\s*$/.test(c)&&e.infoViewToOpen.open(b,d)}),this.get("state").markers[a.get("id")]=d,d},selectInfoView:function(a){var b,c,d;return c=a.google,b=a.custom,d=this.get("defaultoverlay")===!0?c:b},getPlaceInfoViewGroup:function(a){var b,c,d;return d=this.get("state").infoViews[a.get("id")],void 0===d&&(c=new google.maps.InfoWindow({content:a.get("details")}),b=new InfoBox({map:this.getContainer(),content:"<div class='ccontent'>"+a.get("details")+"</div>",disableAutoPan:!1,pixelOffset:new google.maps.Size(-250,0),boxClass:"cinfobox",boxStyle:{opacity:.9,width:"500px"},closeBoxMargin:"0",closeBoxURL:this.config.baseURL+"media/images/close_icon.png",infoBoxClearance:new google.maps.Size(1,1)}),d={google:c,custom:b},this.get("state").infoViews[a.get("id")]=d),d},onOverlayStateUpdated:function(a){this.set("defaultoverlay",void 0===a.get("overlayenable")||a.get("overlayenable")===!1),this.set("overlaymultiple",a.get("overlaymultiple"))},onPlaceFilter:function(a){var b,c,d,e;for(b in this.get("state").markers)c=this.get("state").markers[b],d=c._refplace,e=d.isPassingCriteriaCheck(a),c.setVisible(e);this.get("clustering")&&this.resetClustering()},resetClustering:function(){var a;null!=this.markerClusterer&&(this.markerClusterer.repaint(),a=this.getContainer(),google.maps.event.trigger(a,"resize"),a.setZoom(a.getZoom()-1),a.setZoom(a.getZoom()+1))},onPlaceFocus:function(a){var b,c,d,e,f;c=this.get("channel"),d=a.get("lat"),e=a.get("lng"),Cetabo.EventDistpatcher.use(c).trigger("map.updatecenter",d,e),Cetabo.EventDistpatcher.use(c).trigger("map.updatezoom",10),f=this.getMarkerByPlace(a),null!==f&&(b=f.getAnimation,f.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){f.setAnimation(b)},2e3))},getMarkerByPlace:function(a){var b,c,d;for(b in this.get("state").markers)if(c=this.get("state").markers[b],d=c._refplace,a.id===d.id)return c;return null},onClusteringStateUpdated:function(a){this.isAllowingClustering()&&(a?this.enableClustering():this.disableClustering())},enableClustering:function(){var a;this.set("clustering",!0),a=this.getVisibleMarkers(),null!=a&&(void 0===this.markerClusterer?this.markerClusterer=new MarkerClusterer(this.getContainer(),a,{ignoreHidden:!0}):(this.markerClusterer.clearMarkers(),this.markerClusterer.addMarkers(a),this.markerClusterer.repaint()))},disableClustering:function(){var a;this.set("clustering",!1),void 0!==this.markerClusterer&&(this.markerClusterer.clearMarkers(),this.markerClusterer.repaint(),a=this.getVisibleMarkers(),this.reatachToContainer(a,this.getContainer()))},reatachToContainer:function(a,b){var c,d;d=[];for(c in a)d.push(a[c].setMap(b));return d},onPlaceStateUpdated:function(){var a,b;if(b=this.getVisibleMarkers(),null!=this.markerClusterer&&null!=b)for(a=0;a<b.length;)this.markerClusterer.addMarker(b[a]),a++},getVisibleMarkers:function(){var a,b,c,d,e;if(d=[],null!=this.get("state")){a=0;for(b in this.get("state").markers)c=this.get("state").markers[b],e=c._refplace,"hyperlapse"!==e.get("type")&&(d[b]=c)}return d},refreshClustering:function(){},bindEvents:function(a){var b,c;c=this.get("state").markers[a.get("id")],b=this.get("channel"),google.maps.event.addListener(c,"dragend",function(){var d;d=c.getPosition(),a.set("lat",d.lat()),a.set("lng",d.lng()),Cetabo.EventDistpatcher.use(b).trigger("place.update",a)}),google.maps.event.addListener(c,"mousedown",function(){Cetabo.EventDistpatcher.use(b).trigger("place.select",a)})},updateMarker:function(a){var b,c,d;b=a.get("id"),c=this.get("state").markers[b],void 0!==c&&(c.setTitle(a.get("name")),c.setIcon(a.get("icon")),c.setAnimation(a.get("animation")),c.setPosition(new google.maps.LatLng(a.get("lat"),a.get("lng"))),d=this.getPlaceInfoViewGroup(a),d.google.setContent(a.get("details")),d.custom.setContent("<div class='ccontent'>"+a.get("details")+"</div>"))},removeMarker:function(a){var b,c;b=a.get("id"),c=this.get("state").markers[b],void 0!==c&&c.setMap(null)},addCustomControll:function(){},removeCustomControll:function(){var a;a=this.get("customcontroll"),void 0!==a&&null!==a&&jQuery(a).hide()}})}.call(this),function(){Cetabo.MapManager=Cetabo.MarkerManager.extend({initialize:function(a){var b;Cetabo.MapManager.__super__.initialize.apply(this,arguments),this.config=a,this.initMap(),b=this.get("channel"),Cetabo.EventDistpatcher.use(b).on("map.updatecenter",this.onChangeMapPosition,this),Cetabo.EventDistpatcher.use(b).on("map.updatezoom",this.onChangeMapZoom,this),Cetabo.EventDistpatcher.use(b).on("map.updatezoomrange",this.onChangeMapZoomRange,this),Cetabo.EventDistpatcher.use(b).on("map.updatetype",this.onChangeMapType,this),Cetabo.EventDistpatcher.use(b).on("map.updatesize",this.onUpdateSize,this),Cetabo.EventDistpatcher.use(b).on("map.updatemode",this.onChangeMode,this),Cetabo.EventDistpatcher.use(b).on("map.updatedragging",this.onChangeMapDragging,this),Cetabo.EventDistpatcher.use(b).on("map.updatedoubleclickzoom",this.onChangeMapDoubleClickZoom,this),Cetabo.EventDistpatcher.use(b).on("map.updatescrollwellzoom",this.onChangeMapScrollWellZoom,this),Cetabo.EventDistpatcher.use(b).on("map.updatezoomcontrol",this.onUpdateZoomControl,this),Cetabo.EventDistpatcher.use(b).on("map.updatezoomcontrolposition",this.onUpdateZoomControlPosition,this),Cetabo.EventDistpatcher.use(b).on("map.updatestreetviewcontrol",this.onUpdateStreetViewControl,this),Cetabo.EventDistpatcher.use(b).on("map.updatestreetviewcontrolposition",this.onUpdateStreetViewControlPosition,this),Cetabo.EventDistpatcher.use(b).on("map.updatepancontrol",this.onUpdatePanControl,this),Cetabo.EventDistpatcher.use(b).on("map.updatepancontrolposition",this.onUpdatePanControlPosition,this),Cetabo.EventDistpatcher.use(b).on("map.updatemaptypecontrol",this.onUpdateMapTypeControl,this),Cetabo.EventDistpatcher.use(b).on("map.updatemaptypecontrolposition",this.onUpdateMapTypeControlPosition,this),Cetabo.EventDistpatcher.use(b).on("map.updatescalecontrol",this.onUpdateScaleControl,this),Cetabo.EventDistpatcher.use(b).on("place.add",this.onAddPlaces,this),Cetabo.EventDistpatcher.use(b).on("place.remove",this.onRemovePlace,this),Cetabo.EventDistpatcher.use(b).on("place.update",this.onUpdatePlace,this),Cetabo.EventDistpatcher.use(b).on("styler.update",this.onUpdateStyle,this),Cetabo.EventDistpatcher.use(b).on("screen.updatesize",this.onUpdateScreenSize,this),Cetabo.EventDistpatcher.use(b).on("screen.resized",this.onScreenResolutionChanged,this)},initMap:function(a){var b,c,d,e;google.maps.visualRefresh=!0,c=this.config.el,b=this.get("channel"),e=this,d=jQuery.extend({zoom:3,center:new google.maps.LatLng(39.5312,-102.6502),panControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.TOP_RIGHT},scaleControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},streetViewControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT}},a),this.map=new google.maps.Map(document.getElementById(c),d),Cetabo.EventDistpatcher.use(b).trigger("map.updatecenter",this.map.getCenter().lat(),this.map.getCenter().lng()),google.maps.event.addListener(this.map,"dragend",function(){Cetabo.EventDistpatcher.use(b).trigger("map.updatecenter",this.getCenter().lat(),this.getCenter().lng())}),google.maps.event.addListener(this.map,"zoom_changed",function(){var a,c;return c=this.getZoom(),a=parseInt(e.normalizeZoom(c)),null!=a&&a!==c?void this.setZoom(a):void Cetabo.EventDistpatcher.use(b).trigger("map.updatezoom",this.getZoom())}),Cetabo.EventDistpatcher.use(b).trigger("map.created",this.map)},normalizeZoom:function(a){var b,c;return null==this.zoomRange?a:(c=this.zoomRange.min,b=this.zoomRange.max,b>a&&a>c?a:Math.abs(b-a)<Math.abs(c-a)?b:c)},onChangeMapPosition:function(a,b){var c;void 0!==a&&void 0!==b&&(c=new google.maps.LatLng(a,b),this.map.panTo(c),this.map.setCenter(c))},onChangeMapType:function(a){this.map.setMapTypeId(a)},onChangeMode:function(a){var b,c,d;switch(this.mode=a,a){case google.maps.MapMode.STREET:case google.maps.MapMode.HYPERLAPSE:b=this,c=jQuery("#"+this.config.el).height(),d=jQuery("#"+this.config.el).width(),this.set("oldWidth",jQuery("#"+this.get("el")).width()),this.set("oldHeight",jQuery("#"+this.get("el")).height()),this.onUpdateSize(300,300),jQuery("#"+this.config.el).addClass("street-mode"),jQuery("#"+this.config.el).resizable({animate:!1,maxHeight:c,maxWidth:d,handles:"n, e, s, w, se",resize:function(a,c){b.onUpdateSize(c.size.width,c.size.height)}}),this.removeCustomControll();break;case google.maps.MapMode.MAP:this.set("width",this.get("oldWidth")),this.set("height",this.get("oldHeight")),jQuery("#"+this.config.el).hasClass("street-mode")&&jQuery("#"+this.config.el).resizable("destroy"),jQuery("#"+this.config.el).removeClass("street-mode"),jQuery("#"+this.config.el).css({position:"relative"}),this.onUpdateSize(this.get("width"),this.get("height")),this.addCustomControll(this.map)}},isMasterView:function(){return google.maps.MapMode.MAP===this.mode},onUpdateScreenSize:function(a,b){this.isMasterView()&&this.onUpdateSize(a,b)},onScreenResolutionChanged:function(){var a;a=this.map.getCenter(),google.maps.event.trigger(this.map,"resize"),this.map.panTo(a)},onChangeMapZoomRange:function(a){this.zoomRange=a},onChangeMapZoom:function(a){a===this.map.getZoom()||isNaN(a)||void 0===a||this.map.setZoom(a)},onUpdateStyle:function(a){void 0!==a&&this.map.setOptions({styles:a})},onUpdateSize:function(a,b){var c;void 0!==a&&void 0!==b&&(jQuery("#"+this.get("el")).width(a).height(b),this.set("width",a),this.set("height",b),c=this.map.getCenter(),google.maps.event.trigger(this.map,"resize"),this.map.panTo(c),this.map.setCenter(c))},onAddPlaces:function(a){a.get("renderedOnMap")!==!0&&(this.addMarker(a,this.map),a.set("renderedOnMap",!0))},getNewMarlerReference:function(){return this.map.getCenter()},isNewMarkerReferenceProvider:function(){return google.maps.MapMode.STREET!==this.mode},onUpdatePlace:function(a){this.updateMarker(a)},onRemovePlace:function(a){this.removeMarker(a)},getContainer:function(){return this.map},onChangeMapDragging:function(a){this.map.setOptions({draggable:a})},onChangeMapDoubleClickZoom:function(a){this.map.setOptions({disableDoubleClickZoom:!a})},onChangeMapScrollWellZoom:function(a){this.map.setOptions({scrollwheel:a})},onUpdateZoomControl:function(a){this.map.setOptions({zoomControl:a})},onUpdateZoomControlPosition:function(a){this.map.setOptions({zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:a}})},onUpdateStreetViewControl:function(a){this.map.setOptions({streetViewControl:a})},onUpdateStreetViewControlPosition:function(a){this.map.setOptions({streetViewControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:a}})},onUpdatePanControl:function(a){this.map.setOptions({panControl:a})},onUpdatePanControlPosition:function(a){this.map.setOptions({panControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:a}})},onUpdateMapTypeControl:function(a){this.map.setOptions({mapTypeControl:a})},onUpdateMapTypeControlPosition:function(a){this.map.setOptions({mapTypeControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:a}})},onUpdateScaleControl:function(a){this.map.setOptions({scaleControl:a})}})}.call(this),function(){Cetabo.StreetManager=Cetabo.MarkerManager.extend({initialize:function(a){var b;Cetabo.StreetManager.__super__.initialize.apply(this,arguments),this.config=a,b=this.get("channel"),Cetabo.EventDistpatcher.use(b).on("place.add",this.onAddPlaces,this),Cetabo.EventDistpatcher.use(b).on("place.remove",this.onRemovePlace,this),Cetabo.EventDistpatcher.use(b).on("place.update",this.onUpdatePlace,this),Cetabo.EventDistpatcher.use(b).on("map.created",this.onMapCreated,this),Cetabo.EventDistpatcher.use(b).on("map.updatesize",this.onUpdateSize,this),Cetabo.EventDistpatcher.use(b).on("map.updatemode",this.onChangeMode,this),Cetabo.EventDistpatcher.use(b).on("street.updateposition",this.onChangePosition,this),Cetabo.EventDistpatcher.use(b).on("street.updatepov",this.onChangePov,this),Cetabo.EventDistpatcher.use(b).on("screen.updatesize",this.onUpdateScreenSize,this),Cetabo.EventDistpatcher.use(b).on("screen.resized",this.onScreenResolutionChanged,this)},initStreet:function(a){var b;this.streetViewService=new google.maps.StreetViewService,this.panorama=new google.maps.StreetViewPanorama(document.getElementById(a),this.preparePanoramaOptions()),this.panorama.getDiv=function(){return a},this.panorama.getCenter=function(){return this.getPosition()},b=this.get("channel"),google.maps.event.addListener(this.panorama,"position_changed",function(){var a;a=this.getPosition(),void 0!==a&&Cetabo.EventDistpatcher.use(b).trigger("street.updateposition",a.lat(),a.lng())}),google.maps.event.addListener(this.panorama,"pov_changed",function(){Cetabo.EventDistpatcher.use(b).trigger("street.updatepov",this.getPov())})},preparePanoramaOptions:function(){return{pov:{heading:34,pitch:10},addressControl:!0,addressControlOptions:{style:{backgroundColor:"grey",color:"yellow"},position:google.maps.ControlPosition.LEFT_BOTTOM},panControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP}}},onChangeMode:function(a){var b,c;this.mode=a,b=jQuery("#"+this.config.el),google.maps.MapMode.STREET===a?(b.show(),c=this.panorama.getPosition(),this.verifyStreetViewAvailable(c),this.map.setStreetView(this.panorama),this.panorama.setVisible(!0),this.onChangePosition(this.get("lat"),this.get("lng")),this.addCustomControll(this.panorama),this.focusToNearestStreetPositionIfRequired()):(b.hide(),jQuery("#"+this.config.errorEl).hide(),this.map.setStreetView(null),this.map.getStreetView().setVisible(!1),this.removeCustomControll())},focusToNearestStreetPositionIfRequired:function(){var a,b,c;if(void 0===this.panorama.getPosition())return c=this,b=this.map.getCenter(),a=new google.maps.DirectionsService,a.route({origin:b,destination:b,travelMode:google.maps.DirectionsTravelMode.DRIVING},function(a,b){var d;b===google.maps.DirectionsStatus.OK&&void 0!==a&&void 0!==a.routes&&void 0!==a.routes[0]&&void 0!==a.routes[0]&&void 0!==a.routes[0].legs[0]&&void 0!==a.routes[0].legs[0].start_location&&(d=a.routes[0].legs[0].start_location,c.onChangePosition(d.lat(),d.lng()))})},isMasterView:function(){return google.maps.MapMode.STREET===this.mode},onUpdateScreenSize:function(a,b){this.isMasterView()&&this.onUpdateSize(a,b)},onScreenResolutionChanged:function(){google.maps.event.trigger(this.panorama,"resize")},verifyStreetViewAvailable:function(a){var b;return b=this,this.isMasterView()?void 0===a?void jQuery("#"+b.config.errorEl).show():void this.streetViewService.getPanoramaByLocation(a,50,function(a,c){return c===google.maps.StreetViewStatus.OK?void jQuery("#"+b.config.errorEl).hide():void jQuery("#"+b.config.errorEl).show()}):void 0},onChangePosition:function(a,b){var c,d,e;c=this.panorama.getPosition(),d=void 0!==c&&c.lat()===a&&c.lng()===b,void 0===a||void 0===b||d||(e=new google.maps.LatLng(a,b),this.panorama.setPosition(e)),this.verifyStreetViewAvailable(this.panorama.getPosition()),this.set("lat",a),this.set("lng",b)},onChangePov:function(a){var b,c;void 0!==a&&void 0!==a.heading&&void 0!==a.pitch&&(b=this.panorama.getPov(),c=void 0!==b&&b.heading===a.heading&&b.pitch===a.pitch,c||(b.heading=parseFloat(a.heading),b.pitch=parseFloat(a.pitch),this.panorama.setPov(b),this.set("pov",b)))},onMapCreated:function(a){this.map=a,this.initStreet(this.config.el)},onUpdateSize:function(a,b){void 0!==a&&void 0!==b&&(jQuery("#"+this.get("el")).width(a).height(b),google.maps.event.trigger(this.panorama,"resize"))},onAddPlaces:function(a){a.get("renderedOnStreet")!==!0&&(this.addMarker(a,this.panorama),a.set("renderedOnStreet",!0))},getNewMarlerReference:function(){var a;return a=this.panorama.getPosition(),google.maps.geometry.spherical.computeOffset(a,10,this.panorama.getPov().heading)},isNewMarkerReferenceProvider:function(){return google.maps.MapMode.STREET===this.mode},onUpdatePlace:function(a){this.updateMarker(a)},onRemovePlace:function(a){this.removeMarker(a)},getContainer:function(){return this.panorama},isAllowingClustering:function(){return!1}})}.call(this),function(){Cetabo.DirectionManager=Cetabo.BaseManager.extend({trackingHandler:[],placeReference:[],MAX_ALLOWED_DIRECTION_PINS:30,initialize:function(a){this.config=a,this.canvas=a.canvas,this.channel=this.get("channel"),Cetabo.EventDistpatcher.use(this.channel).on("map.created",this.onMapCreated,this),Cetabo.EventDistpatcher.use(this.channel).on("direction.show",this.calcRoute,this),Cetabo.EventDistpatcher.use(this.channel).on("direction.clean",this.cleanRoute,this),Cetabo.EventDistpatcher.use(this.channel).on("direction.track",this.trackCurrentLocation,this),Cetabo.EventDistpatcher.use(this.channel).on("direction.untrack",this.untrackCurrentLocation,this)},onMapCreated:function(a){var b;this.map=a,b={map:a,draggable:!1},this.directionsService=new google.maps.DirectionsService,this.directionsDisplay=new google.maps.DirectionsRenderer(b)},isValidRequest:function(a){return void 0===a||this.routeArgs===a||void 0===a.request||""===a.request.origin?!1:(this.routeArgs=a,!0)},calcRoute:function(a){var b,c;this.isValidRequest(a)&&(c=this,b=this.channel,this.cleanMarkers(),this.directionsService.route(a.request,function(d,e){e===google.maps.DirectionsStatus.OK?(c.directionsDisplay.setDirections(d),a.showSteps&&c.showSteps(d),0!==d.routes[0].warnings.length&&Cetabo.EventDistpatcher.use(b).trigger("direction.message",d.routes[0].warnings)):Cetabo.EventDistpatcher.use(b).trigger("direction.message","There was a problem in computing the route.")}))},cleanRoute:function(){this.directionsDisplay.setDirections(response),this.showSteps([])},cleanMarkers:function(){var a,b,c;for(a=this.channel,b=0;b<this.placeReference.length;)c=this.placeReference[b],Cetabo.EventDistpatcher.use(a).trigger("place.remove",c),b++;this.markerArray=[]},showSteps:function(a){var b,c,d,e,f,g,h,i,j;for(f=a.routes[0].legs[0],c=this.channel,j=f.steps.length,b=this.MAX_ALLOWED_DIRECTION_PINS,i=Math.floor(b>j?1:j/b),d=0;d<f.steps.length;)d%i===0&&(h=f.steps[d].start_point,e="_dir"+Math.floor(1e5*Math.random()),g=new Cetabo.PlaceModel({id:e,name:"",channel:c,icon:this.config.baseURL+"media/images/cetabo_icons/pin_default_purple.png",lat:h.lat(),lng:h.lng(),details:f.steps[d].instructions,locked:!0,"transient":!0}),Cetabo.EventDistpatcher.use(c).trigger("place.add",g),Cetabo.EventDistpatcher.use(c).trigger("place.update",g),this.placeReference.push(g),d++)},isGeolocationSupportAvailable:function(){return navigator.geolocation},trackCurrentLocation:function(a){return this.isGeolocationSupportAvailable()?void this.refreshCurrentGeolocation(a):void this.handleNoGeolocation()},untrackCurrentLocation:function(){var a;for(a=0;a<this.trackingHandler.length;)clearInterval(this.trackingHandler[a]),a++;this.trackingHandler=[],void 0!==this.currentLocationMarker&&(this.currentLocationMarker.setMap(null),this.currentLocationMarker=void 0),void 0!==this.currentLocationAccuracy&&(this.currentLocationAccuracy.setMap(null),this.currentLocationAccuracy=void 0)},refreshCurrentGeolocation:function(a){var b,c;c=this,b=setInterval(function(){navigator.geolocation.getCurrentPosition(function(a){c.currentLocation=new google.maps.LatLng(a.coords.latitude,a.coords.longitude),c.coords=a.coords,c.updateCurrentLocationMarker()},function(){c.handleNoGeolocation(),c.untrackCurrentLocation()})},a),this.trackingHandler.push(b)},updateCurrentLocationMarker:function(){void 0===this.currentLocationMarker?(this.currentLocationAccuracy=new google.maps.Circle({strokeColor:"#5278F2",strokeOpacity:.8,strokeWeight:2,fillColor:"#52CCF2",fillOpacity:.35,map:this.map,center:this.currentLocation,radius:this.coords.accuracy}),this.currentLocationMarker=new google.maps.Marker({position:this.currentLocation,map:this.map,icon:this.config.baseURL+"media/images/current_location.png"})):(this.currentLocationMarker.setPosition(this.currentLocation),this.currentLocationAccuracy.setCenter(this.currentLocation),this.currentLocationAccuracy.setRadius(this.coords.accuracy))},handleNoGeolocation:function(){var a;a=this.channel,Cetabo.EventDistpatcher.use(a).trigger("direction.message","Your browser doesn't support geolocation.")}})}.call(this),function(){Cetabo.BaseProvider=Backbone.Model.extend({invoke:function(a){a()},getDataModel:function(){var a,b,c,d;for(d=[],b=this.getData(),c=0;c<b.length;)a=b[c],d.push(a),c++;return d},valueOf:function(a){var b,c;b=this.getData();for(c in b)if(a(b[c]))return b[c];return void 0},getData:function(){return this.get("data")},setData:function(a){this.set("data",a)},getDefault:function(){return 0}})}.call(this),function(){Cetabo.DirectionTypeProviderModel=Cetabo.BaseProvider.extend({initialize:function(){var a;a=[{text:"DRIVING",id:google.maps.TravelMode.DRIVING,description:"Indicates standard driving directions using the road network."},{text:"BICYCLING",id:google.maps.TravelMode.BICYCLING,description:"Requests bicycling directions via bicycle paths & preferred streets."},{text:"TRANSIT",id:google.maps.TravelMode.TRANSIT,description:"Requests directions via public transit routes"},{text:"WALKING",id:google.maps.TravelMode.WALKING,description:"Requests walking directions via pedestrian paths & sidewalks"}],this.setData(a)}})}.call(this),function(){Cetabo.SidebarType={NONE:0,TAGS:1,PLACES:2,DIRECTION:3},Cetabo.SidebarTypeProviderModel=Cetabo.BaseProvider.extend({initialize:function(){var a;a=[{text:"NONE",id:0,description:"Noting is opened"},{text:"TAGS",id:1,description:"Show tags tab opened"},{text:"PLACES",id:2,description:"Show places tab opened"},{text:"DIRECTION",id:3,description:"Show direction tab opened"}],this.setData(a)}})}.call(this),function(){Cetabo.PlaceModel=Backbone.Model.extend({initialize:function(){var a;a=this.get("channel"),this.on("change:lat",function(a){var b;void 0!==a&&(b=a.get("lat"),jQuery("#"+a.get("id")+" .lat").val(b))}),this.on("change:lng",function(a){var b;void 0!==a&&(b=a.get("lng"),jQuery("#"+a.get("id")+" .lng").val(b))}),this.on("change:name",function(b){void 0!==b&&Cetabo.EventDistpatcher.use(a).trigger("place.update",this)}),this.on("change:details",function(b){void 0!==b&&Cetabo.EventDistpatcher.use(a).trigger("place.update",this)})},toJSON:function(){return{id:this.get("_id"),name:this.get("name"),tags:this.get("tags"),lat:this.get("lat"),lng:this.get("lng"),icon:this.get("icon"),iconCustomName:this.get("iconCustomName"),iconCustomId:this.get("iconCustomId"),details:this.get("details"),animation:this.get("animation"),type:this.get("type")}},hasTag:function(a){var b,c,d,e;if(void 0===this.get("tags"))return!1;for(b=this.get("tags").split(","),c=0,d=b.length;d>c;c++)if(e=b[c],String(e)===String(a))return!0;return!1},hasAnyOfTags:function(a){var b,c,d;for(b=0,c=a.length;c>b;b++)if(d=a[b],this.hasTag(d))return!0;return!1},toGoogleMapsPoint:function(){return new google.maps.LatLng(this.get("lat"),this.get("lng"))},validate:function(){var a,b;return b=[],a=[],this.get("name")||(b.push("Places > You must provide a name for place"),a.push("#"+this.get("id")+" .name")),(!this.get("lat")||isNaN(this.get("lat")))&&(b.push("Places > Invalid place lat, must be a valid coordonate."),a.push("#"+this.get("id")+" .lat")),(!this.get("lng")||isNaN(this.get("lng")))&&(b.push("Places > Invalid place lng, must be a valid coordonate."),a.push("#"+this.get("id")+" .lng")),0!==b.length&&a.push(".header-"+this.get("id")),{messages:b,fields:a,hasError:0!==b.length}},isPassingCriteriaCheck:function(a){var b;return b=!0,null!=a.tags&&a.tags.length>0&&(b=b&&this.hasAnyOfTags(a.tags)),b}})}.call(this),function(){Cetabo.StylerModel=Backbone.Model.extend({initialize:function(){null==this.get("visibility")&&this.set("visibility","on"),null==this.get("stylers")&&this.set("stylers",[])},isValid:function(){return this.isValidProperty("featureType")&&this.isValidProperty("elementType")&&("off"===this.get("visibility")||this.isValidProperty("visibility"))?!0:!1},isValidProperty:function(a){var b;return b=this.get(a),void 0!==b&&!Cetabo.StringUtil.isEmpty(b)},toJSON:function(){return{featureType:this.get("featureType"),elementType:this.get("elementType"),stylers:this.get("stylers")}},getStyler:function(a){var b,c,d;for(d=this.get("stylers"),b=0;b<d.length;){if(c=d[b],void 0!==c[a])return c[a];b++}return null},setStyler:function(a,b){var c,d,e,f,g;for(g=this.get("stylers"),c=!1,d=0;d<g.length;)f=g[d],void 0!==f[a]&&(f[a]=b,c=!0),d++;c||(e={},e[a]=b,g.push(e)),this.set("stylers",g)},validate:function(){var a,b;return b=[],a=[],this.get("featureType")||(b.push("Style > You must select feature"),a.push("#"+this.get("id")+" .feature-type")),this.get("elementType")||(b.push("Style > You must select element"),a.push("#"+this.get("id")+" .element-type")),0!==b.length&&a.push(".header-"+this.get("id")),{messages:b,fields:a,hasError:0!==b.length}}})}.call(this),function(){google.maps.MapMode={MAP:"1",STREET:"2",HYPERLAPSE:"3"}}.call(this),function(){Cetabo.MapModel=Backbone.Model.extend({initialize:function(){this.on("change:name",function(a){var b;void 0!==a&&(b=a.get("name"),jQuery("#"+a.get("el")+" .name").val(b))}),this.set("places",{}),this.set("stylers",{})},toJSON:function(){return{id:this.get("id"),name:this.get("name"),lat:this.get("lat"),lng:this.get("lng"),zoom:this.get("zoom"),zoomrange:this.get("zoomrange"),width:this.get("width"),height:this.get("height"),type:this.get("type"),mode:this.get("mode"),dragging:this.get("dragging"),doubleclickzoom:this.get("doubleclickzoom"),scrollwellzoom:this.get("scrollwellzoom"),zoomcontrol:this.get("zoomcontrol"),zoomcontrolposition:this.get("zoomcontrolposition"),streetviewcontrol:this.get("streetviewcontrol"),streetviewcontrolposition:this.get("streetviewcontrolposition"),maptypecontrol:this.get("maptypecontrol"),maptypecontrolposition:this.get("maptypecontrolposition"),pancontrol:this.get("pancontrol"),pancontrolposition:this.get("pancontrolposition"),scalecontrol:this.get("scalecontrol"),streetlng:this.get("streetlng"),streetlat:this.get("streetlat"),heading:this.get("heading"),pitch:this.get("pitch"),enablefullscreen:this.get("enablefullscreen"),startfullscreen:this.get("startfullscreen"),enableaddressearch:this.get("enableaddressearch"),defaultsidebartab:this.get("defaultsidebartab"),enabledirection:this.get("enabledirection"),enabletags:this.get("enabletags"),enableplaces:this.get("enableplaces"),showsteps:this.get("showsteps"),overlayenable:this.get("overlayenable"),overlaymultiple:this.get("overlaymultiple"),places:this.collectionToJSON(this.get("places"),function(a){return a.get("transient")!==!0}),stylers:this.collectionToJSON(this.get("stylers")),clustering:this.get("clustering")}},validate:function(){var a,b,c,d,e,f,g;c=[],a=[],this.get("name")||(c.push("You must provide a name for map"),a.push(".top .name")),this.get("width")&&/([0-9]+)(px|em|ex|%|in|cm|mm|pt|pc)/.test(this.get("width"))||(c.push("Settings > Invalid map width, must be a valid width value in px or %."),a.push(".width")),this.get("height")&&/([0-9]+)(px|em|ex|%|in|cm|mm|pt|pc)/.test(this.get("height"))||(c.push("Settings > Invalid map height, must be a valid width value in px or %."),a.push(".height")),(!this.get("lat")||isNaN(this.get("lat")))&&(c.push("Settings > Invalid map center lat, must be a valid coordonate."),a.push(".lat")),(!this.get("lng")||isNaN(this.get("lng")))&&(c.push("Settings > Invalid map center lng, must be a valid coordonate."),a.push(".lng")),this.get("type")||(c.push("Settings > Invalid map type specified."),a.push(".type")),e=this.get("places");
for(b in e)d=e[b].validate(),e[b].get("transient")!==!0&&d.hasError&&(c=c.concat(d.messages),a=a.concat(d.fields));g=this.get("stylers");for(b in g)f=g[b].validate(),f.hasError&&(c=c.concat(f.messages),a=a.concat(f.fields));return{messages:c,fields:a,hasError:0!==c.length}},collectionToJSON:function(a,b){var c,d;d=[];for(c in a)(void 0===b||b(a[c]))&&d.push(a[c].toJSON());return d},collectionToArray:function(a,b){var c,d;d=[];for(c in a)(void 0===b||b(a[c]))&&d.push(a[c]);return d},addPlace:function(a,b){var c;c=this.get("places"),c[a]=b},removePlace:function(a){var b;b=this.get("places"),delete b[a]},getPlaceById:function(a){var b;return b=this.get("places"),b[a]},getPlaceKeysByAttribute:function(a,b){var c,d,e,f,g;e=[],g=this.get("places");for(d in g)if(f=g[d],b instanceof Array)for(c=0;c<b.length;)f.get(a)===b[c]&&e.push(d),c++;else f.get(a)===b&&e.push(d);return e},getPlacesByAttribute:function(a,b){var c,d,e,f;for(f={},e=this.getPlaceKeysByAttribute(a,b),c=0;c<e.length;)d=e[c],f[d]=this.getPlaceById(d),c++;return f},getPlaceByAttribute:function(a,b){var c,d;d=this.getPlacesByAttribute(a,b);for(c in d)return d[c];return void 0},removePlaceByAttribute:function(a,b){var c;c=this.getPlaceKeysByAttribute(a,b),this.removePlace(c)},addStyler:function(a,b){var c;c=this.get("stylers"),c[a]=b},removeStyler:function(a){var b;b=this.get("stylers"),delete b[a]},getStylerById:function(a){var b;return b=this.get("stylers"),b[a]},buildMapStyler:function(){var a,b,c,d;b=[],d=this.get("stylers");for(a in d)c=d[a],c.isValid()&&b.push(c.toJSON());return b},prepareModelState:function(a){var b;return b=a.map.configuration,b.id=a.map.id,b},load:function(a){var b,c,d;c=this.prepareModelState(a);for(b in c)d=c[b],"[object Array]"===Object.prototype.toString.call(d)?this.fillFromCollection(b,d):this.set(b,this.convertValue(d))},convertValue:function(a){return"true"===a?!0:"false"===a?!1:a},fillFromCollection:function(a,b){var c,d,e,f,g;this.set(a,{});for(d in b)if(g=b[d],"[object Object]"===Object.prototype.toString.call(g))switch(g.channel=this.get("channel"),c="ident"+Math.floor(1e5*Math.random()),a){case"places":void 0!==g.details&&(g.details=g.details.replace(/\\/g,"")),e=new Cetabo.PlaceModel(g),e.set("id",c),this.addPlace(c,e);break;case"stylers":f=new Cetabo.StylerModel(g),f.set("id",c),this.addStyler(c,f)}},fillStylerModelFromTheme:function(a){var b,c,d,e;for(this.set("stylers",{}),b=0;b<a.length;)e=a[b],"[object Object]"===Object.prototype.toString.call(e)&&(e.channel=this.get("channel"),e.elementType=void 0!==e.elementType?e.elementType:"all",c="ident"+Math.floor(1e5*Math.random()),d=new Cetabo.StylerModel(e),d.set("id",c),this.addStyler(c,d),b++)},getStylersAsTheme:function(){return this.collectionToJSON(this.get("stylers"))},getMapTags:function(){var a,b,c,d,e,f;if(b=[],a=this.get("places"),null==a)return[];for(f=this.collectionToArray(a),c=0,d=f.length;d>c;c++)e=f[c],null!=e.get("tags")&&""!==e.get("tags")&&Cetabo.ArrayUtil.pushArray(b,e.get("tags").split(","));return Cetabo.ArrayUtil.asSet(b)},getMapPlaces:function(){var a;return a=this.get("places"),this.collectionToArray(a,function(a){return a.get("transient")!==!0})}})}.call(this),function(){Cetabo.BaseView=Backbone.View.extend({getElId:function(){return this.enforceELId(this.$el)},enforceELId:function(a){return void 0===a.attr("id")&&a.attr("id","_elm_"+Math.floor(1e5*Math.random())),a.attr("id")},getChannel:function(){return void 0===this.channel&&(this.channel="chn"+Math.floor(1e5*Math.random())),this.channel},find:function(a){return jQuery(this.findIdent(a))},findParent:function(a){return jQuery("#"+this.getElId()).closest(a)},findIdent:function(a){return"#"+this.getElId()+" "+a}})}.call(this),function(){Cetabo.TagsTabView=Cetabo.BaseView.extend({events:{"click .place-tag":"filterPlaces"},initialize:function(a){this.config=a,this.model=a.model,this.channel=a.channel,this.tags=[],Cetabo.EventDistpatcher.use(this.channel).on("map.load",this.onLoadMapCallback,this),Cetabo.EventDistpatcher.use(this.channel).on("place.updateTag",this.onUpdatePlaceTag,this)},onUpdatePlaceTag:function(){this.resetTagSelection(),this.onLoadMapCallback(this.model)},resetTagSelection:function(){this.tags=[],this.find(".place-tag").removeClass("active"),Cetabo.EventDistpatcher.use(this.channel).trigger("place.filter",{tags:this.tags})},onLoadMapCallback:function(a){var b,c,d;c=a.getMapTags(),d=Cetabo.TemplateManager.getTemplateByName("#template-tags"),b=d({tags:c}),this.find("").html(b),this.delegateEvents()},filterPlaces:function(a){var b;return b=a.currentTarget,this.fillCriteria(b),this.setActiveTag(b),Cetabo.EventDistpatcher.use(this.channel).trigger("place.filter",{tags:this.tags}),!1},fillCriteria:function(a){var b,c,d;d=jQuery(a).data("tag"),b=this.isActiveTag(a),b?(c=this.tags.indexOf(d),c>-1&&this.tags.splice(c,1)):this.tags.push(d)},isActiveTag:function(a){return jQuery(a).hasClass("active-tag")},setActiveTag:function(a){this.isActiveTag(a)?jQuery(a).removeClass("active-tag"):jQuery(a).addClass("active-tag")}})}.call(this),function(){Cetabo.PlacesTabView=Cetabo.BaseView.extend({events:{"click .place-ident":"focusPlace"},initialize:function(a){this.config=a,this.model=a.model,this.channel=a.channel,Cetabo.EventDistpatcher.use(this.channel).on("map.load",this.onLoadMapCallback,this),Cetabo.EventDistpatcher.use(this.channel).on("place.filter",this.onPlaceFilter,this),Cetabo.EventDistpatcher.use(this.channel).on("place.remove",this.onRemovePlace,this),Cetabo.EventDistpatcher.use(this.channel).on("place.update",this.onUpdatePlace,this)},onRemovePlace:function(a){var b;b=this.model.getMapPlaces(),b.pop(a),this.refreshPlaces(b)},onUpdatePlace:function(a){var b,c,d,e,f;for(b=this.model.getMapPlaces(),this.isStepPlace(a)&&b.push(a),c=[],d=0,e=b.length;e>d;d++)f=b[d],this.isPlaceNameNotEmpty(f)&&c.push(f);this.refreshPlaces(c)},isPlaceNameNotEmpty:function(a){return void 0!==a.get("name")&&a.get("name").trim().length>0?!0:void 0},isStepPlace:function(a){return a.get("transient")===!0},onLoadMapCallback:function(a){this.refreshPlaces(a.getMapPlaces())},onPlaceFilter:function(a){var b,c,d,e,f;for(b=this.model.getMapPlaces(),c=[],d=0,e=b.length;e>d;d++)f=b[d],f.isPassingCriteriaCheck(a)&&this.isPlaceNameNotEmpty(f)&&c.push(f);this.refreshPlaces(c)},refreshPlaces:function(a){var b,c;c=Cetabo.TemplateManager.getTemplateByName("#template-places"),b=c({places:a}),this.find("").html(b),this.delegateEvents()},focusPlace:function(a){var b,c,d;return d=a.currentTarget,c=this.resolvePlace(d),b=this.model.getPlaceById(c),Cetabo.EventDistpatcher.use(this.channel).trigger("place.focus",b),!1},resolvePlace:function(a){return jQuery(a).data("place")}})}.call(this),function(){Cetabo.DirectionTabView=Cetabo.PlacesTabView.extend({events:function(){return _.extend({},Cetabo.PlacesTabView.prototype.events,{"click .calculate-route":"calculateRoute","click .direction-type":"selectDirectionType"})},initialize:function(a){var b;this.config=a,this.model=a.model,this.channel=a.channel,this.travelMode="DRIVING",this.initUIControll(),b=this.getChannel(),Cetabo.EventDistpatcher.use(b).on("place.add",this.onAddPlaces,this),Cetabo.EventDistpatcher.use(b).on("place.remove",this.onRemovePlace,this),Cetabo.EventDistpatcher.use(b).on("place.update",this.onUpdatePlace,this),Cetabo.EventDistpatcher.use(b).on("direction.message",this.onDirectionMessage,this),Cetabo.EventDistpatcher.use(b).on("direction.stateupdate",this.onDirectionButtonStateUpdate,this),Cetabo.EventDistpatcher.use(b).on("map.load",this.onLoadMap,this),Cetabo.EventDistpatcher.use(b).on("map.updatemode",this.onChangeMode,this)},initUIControll:function(){this.initAddressPicker(),this.initPlaceSelector(),this.initTravelModeSelector(),this.initNotificationManager()},initNotificationManager:function(){var a;a=this.getChannel(),this.notificationsManager=new Cetabo.NotificationsManager({channel:a+"_private",el:this.find(".message")})},initPlaceSelector:function(){var a;a=this,this.find(" .destination").change(function(){a.calculateRoute()})},initTravelModeSelector:function(){var a;a=this,this.find(".travel-bar input[name='travel_mode']").change(function(){a.calculateRoute()})},initAddressPicker:function(){var a,b;a=this,this.addresspicker=this.find(".origin").addresspicker({updateCallback:function(){a.calculateRoute()}}),b=this.find(".origin").data("ui-autocomplete"),null!=b&&jQuery("#"+b.menu.activeMenu.context.id).addClass("cmap-autocompleate-result")},calculateRoute:function(){var a,b,c,d,e;a=this.getChannel(),null!==this.find(".destination").val()&&(e=this.find(".destination").val().split("|"),b=new google.maps.LatLng(e[0],e[1]),d=this.find(".origin").val(),c={request:{origin:d,destination:b,travelMode:this.travelMode},showSteps:this.model.get("showsteps")},Cetabo.EventDistpatcher.use(a).trigger("direction.show",c))},selectDirectionType:function(a){var b;b=a.currentTarget,this.travelMode=jQuery(b).data("type"),this.find(".active").removeClass("active"),jQuery(b).addClass("active")},updatePlaceSelector:function(a){var b,c,d,e;b="",e=a.get("places");for(c in e)d=e[c],this.isStepPlace(d)||(b+="<option value='"+d.get("lat")+"|"+d.get("lng")+"'>"+d.get("name")+"</option>");this.find(".destination").html(b)},isStepPlace:function(a){return a.get("transient")===!0},onAddPlaces:function(a){this.model.addPlace(a.get("id"),a),this.onModelUpdate()},onRemovePlace:function(a){this.model.removePlace(a.get("id")),this.onModelUpdate()},onUpdatePlace:function(a){this.onModelUpdate(),this.isStepPlace(a)||this.calculateRoute()},onModelUpdate:function(){var a;a=this.model,this.updatePlaceSelector(a),this.updateStepPlaceList(a)},onDirectionMessage:function(a){Cetabo.EventDistpatcher.use(this.getChannel()+"_private").trigger("notification.show",a)},onLoadMap:function(a){a.get("tracking")===!0?Cetabo.EventDistpatcher.use(this.channel).trigger("direction.track",a.get("trackinginterval")):Cetabo.EventDistpatcher.use(this.channel).trigger("direction.untrack")},onDirectionStateUpdate:function(){var a;a=this.model,this.onLoadMap(a),this.calculateRoute()},updateStepPlaceList:function(a){var b,c,d,e,f,g,h;b="",g=a.get("places"),c=[];for(e in g)f=g[e],this.isStepPlace(f)&&c.push(f);h=Cetabo.TemplateManager.getTemplateByName("#template-steps"),d=h({places:c}),this.find(".steps").html(d)}})}.call(this),function(){Cetabo.SidebarView=Cetabo.BaseView.extend({events:{"click .cmap-close-sidebar":"closeSidebar","click .tabs-left a":"openSidebar"},initialize:function(a){this.config=a,this.model=a.model,this.channel=a.channel,this.visibleTabs=[],this.tabs=[],Cetabo.EventDistpatcher.use(this.channel).on("screen.resized",this.onScreenResolutionChanged,this),Cetabo.EventDistpatcher.use(this.channel).on("screen.updatesize",this.onScreenResolutionChanged,this),Cetabo.EventDistpatcher.use(this.channel).on("map.loaded",this.onScreenResolutionChanged,this),Cetabo.EventDistpatcher.use(this.channel).on("map.load",this.onLoadMap,this),Cetabo.EventDistpatcher.use(this.channel).on("direction.stateupdate",this.onDirectionButtonStateUpdate,this),Cetabo.EventDistpatcher.use(this.channel).on("tags.stateupdate",this.onTagsButtonStateUpdate,this),Cetabo.EventDistpatcher.use(this.channel).on("places.stateupdate",this.onPlacesButtonStateUpdate,this),this.initUIControll()},initUIControll:function(){this.inintTagsTab(),this.initSidebarMenuAction(),this.inintPlacesTab(),this.initDirectionTab(),this.initSlimScroll()},onLoadMap:function(a){var b;switch(b=parseInt(a.get("defaultsidebartab"))){case Cetabo.SidebarType.DIRECTION:this.openSidebarMenu(),this.openSidebarTab("direction"),this.onDirectionButtonStateUpdate(!0);break;case Cetabo.SidebarType.PLACES:this.openSidebarMenu(),this.openSidebarTab("places"),this.onPlacesButtonStateUpdate(!0);break;case Cetabo.SidebarType.TAGS:this.openSidebarMenu(),this.openSidebarTab("tags"),this.onTagsButtonStateUpdate(!0)}},onDirectionButtonStateUpdate:function(a){var b;b=this.find(".c-direction"),this.visibleTabs[".c-direction"]=a,this.updateTabButtonState(b,a),this.updateMenuButtonState()},onTagsButtonStateUpdate:function(a){var b;b=this.find(".c-tags").show(),this.visibleTabs[".c-tags"]=a,this.updateTabButtonState(b,a),this.updateMenuButtonState()},onPlacesButtonStateUpdate:function(a){var b;b=this.find(".c-places").show(),this.visibleTabs[".c-places"]=a,this.updateTabButtonState(b,a),this.updateMenuButtonState()},updateTabButtonState:function(a,b){var c;c=jQuery("#"+a.data("bound")),b?a.show():(a.hide(),c.removeClass("active"))},updateMenuButtonState:function(){this.isAnyTabVisible()?jQuery(this.config.sidebarTrigger).show():jQuery(this.config.sidebarTrigger).hide()},isAnyTabVisible:function(){var a,b;b=!1;for(a in this.visibleTabs)"function"!=typeof this.visibleTabs[a]&&(b=b||this.visibleTabs[a]);return b},onScreenResolutionChanged:function(){this.updateSlimScroll(this.findParent(".cmap-container").height()-90)},initSlimScroll:function(){this.find(".cmap-sidebar-content-inside").each(function(){jQuery(this).niceScroll()}),this.onScreenResolutionChanged()},updateSlimScroll:function(a){this.find(".cmap-sidebar-content-inside").each(function(){jQuery(this).height(a)})},initSidebarMenuAction:function(){var a,b;b=this,a=jQuery(this.config.sidebarTrigger),a.on("click",function(){b.togleSidebar()})},togleSidebar:function(){var a;a=this.$el.hasClass("cmap-sidebar-open"),a?this.closeSidebar():this.openSidebarMenu()},closeSidebar:function(){this.closeSidebarMenu(),this.closeSidebarContent()},closeSidebarMenu:function(){var a;this.find("").removeClass("cmap-sidebar-open"),this.find(".nav-tabs .active").removeClass("active"),a=jQuery(this.config.sidebarTrigger),a.removeClass("cmap-trigger-active")},closeSidebarContent:function(){null!=this.find(".cmap-sidebar-content")&&this.find(".cmap-sidebar-content").hide(),this.find(".active").removeClass("active")},openSidebarMenu:function(){var a;this.find("").addClass("cmap-sidebar-open"),this.find(".nav-tabs .active").addClass("active"),a=jQuery(this.config.sidebarTrigger),a.addClass("cmap-trigger-active")},openSidebarTab:function(a){this.openSidebar(),null!=a&&this.find(".ctab-"+a).addClass("active"),null!=a&&this.find(".c-"+a).addClass("active")},openSidebar:function(){this.find(".cmap-sidebar-content").show()},inintPlacesTab:function(){this.tabs.places=new Cetabo.PlacesTabView(this.getSidebarConfiguration(".pins"))},inintTagsTab:function(){this.tabs.tags=new Cetabo.TagsTabView(this.getSidebarConfiguration(".tags"))},initDirectionTab:function(){this.tabs.direction=new Cetabo.DirectionTabView(this.getSidebarConfiguration(".mapdirection"))},getSidebarConfiguration:function(a){return{el:"#"+this.enforceELId(this.find(a)),channel:this.getChannel(),model:this.model}}})}.call(this),function(){Cetabo.SearchView=Cetabo.BaseView.extend({events:{"click .cmap-search-submit":"toggleSearch"},searchOpen:!1,initialize:function(a){var b,c,d,e;this.config=a,this.model=a.model,this.channel=a.channel,b=this.getChannel(),c=this.find(".cmap-search-submit"),d=this.find(".cmap-search-input"),this.searchAddresSearchPicker=d.addresspicker({updateCallback:function(a,c){Cetabo.EventDistpatcher.use(b).trigger("map.updatecenter",c.lat,c.lng),Cetabo.EventDistpatcher.use(b).trigger("map.updatezoom",10)}}),e=d.data("ui-autocomplete"),null!=e&&jQuery("#"+e.menu.activeMenu.context.id).addClass("cmap-autocompleate-result")},openSearch:function(){this.$el.addClass("cmap-show-search")},closeSearch:function(){this.$el.removeClass("cmap-show-search")},toggleSearch:function(){this.searchOpen=!this.searchOpen,this.searchOpen?this.openSearch():this.closeSearch()}})}.call(this),function(){Cetabo.FullscreenView=Cetabo.BaseView.extend({events:{"click .cmap-fullscreen":"toggleFullscreen"},isFullscreen:!1,bodyState:[],tempPlaceHolder:jQuery('<div class="__tempPlaceHolder"></div>'),$win:jQuery(window),initialize:function(a){this.config=a,this.initFullscreenObserver()},resizeFullscreen:function(){var a,b,c;b="#"+this.getElId(),a=jQuery("html"),a.css({overflow:"hidden"}),c=this.getFullscreenSize(),jQuery(b).addClass("cmap-container-fullscreen"),jQuery(b).css({position:"fixed",width:c.width,height:c.height,top:0,left:0,bottom:0,zIndex:1000010}),this.tempPlaceHolder.insertBefore(b),jQuery(b).appendTo("body"),jQuery("html").css("overflow","hidden"),jQuery("body").css("overflow","hidden"),this.onResizeFullscreen(c.width,c.height)},getFullscreenSize:function(){var a,b,c,d;return d=this.$win.width(),c=this.$win.height(),a=/(iPad|iPhone|iPod)/g.test(navigator.userAgent),a&&(c=this.getIOSWindowHeight()),b={width:d,height:c}},getIOSWindowHeight:function(){var a;return a=document.documentElement.clientWidth/window.innerWidth,window.innerHeight*a},getHeightOfIOSToolbars:function(){var a;return a=(0===window.orientation?screen.height:screen.width)-this.getIOSWindowHeight(),a>1?a:0},initOnResize:function(){var a,b;b=this.getFullscreenSize(),a="#"+this.getElId(),jQuery(a).css({width:b.width,height:b.height}),this.onResizeFullscreen(b.width,b.height)},resizeToDefault:function(){var a,b,c;a="#"+this.getElId(),b=this.getOriginalSize(),c=jQuery(".__tempPlaceHolder"),jQuery("html").removeAttr("style"),jQuery(a).removeClass("cmap-container-fullscreen"),jQuery(a).css({position:"relative",width:b.width,height:b.height,zIndex:10}),this.onResizeOriginalSize(b.width,b.height),c.replaceWith(jQuery(a))},initFullscreenObserver:function(){var a;a=this,jQuery(window).resize(function(){a.isFullscreen&&a.initOnResize()})},toggleFullscreen:function(){this.setFullscreen(!this.isFullscreen)},setFullscreen:function(a){this.isFullscreen=a,a?(this.resizeFullscreen(),this.find(".cmap-fullscreen").addClass("cmap-is-fullscreen")):(this.resizeToDefault(),this.find(".cmap-fullscreen").removeClass("cmap-is-fullscreen"))},onResizeOriginalSize:function(){},onResizeFullscreen:function(){}})}.call(this),function(){Cetabo.MapView=Cetabo.FullscreenView.extend({initialize:function(a){var b;Cetabo.MapView.__super__.initialize.apply(this,arguments),this.config=a,b=this.getChannel(),Cetabo.EventDistpatcher.use(b).on("map.load",this.onLoadMapCallback,this),Cetabo.EventDistpatcher.use(b).on("map.updatesize",this.onUpdateMapSize,this),Cetabo.EventDistpatcher.use(b).on("map.updatemode",this.onChangeMode,this),Cetabo.EventDistpatcher.use(b).on("screen.resized",this.onScreenResolutionChanged,this),Cetabo.EventDistpatcher.use(b).on("screen.stateupdate",this.onUpdateFullscreen,this),Cetabo.EventDistpatcher.use(b).on("view.updatefullscreen",this.onEnableFullscreen,this),Cetabo.EventDistpatcher.use(b).on("view.updatesearch",this.onEnableSearch,this),this.initConnection(a.url.load),this.initModel(),this.initDirectionManager(),this.initStreetManager(),this.initMapManager(),this.initSidebarView(),this.initSearchView(),this.initScreenResizeEvent()},initScreenResizeEvent:function(){var a;a=this.getChannel(),jQuery(window).resize(function(){Cetabo.EventDistpatcher.use(a).trigger("screen.resized")})},initConnection:function(){var a;a=this.getChannel(),this.connectionManager=new Cetabo.ConnectionManager({channel:a})},initSidebarView:function(){this.sidebarView=new Cetabo.SidebarView(this.getSidebarConfiguration())},getSidebarConfiguration:function(){return{el:"#"+this.enforceELId(this.find(".cmap-sidebar")),sidebarTrigger:this.find(".cmap-sidebar-trigger"),channel:this.getChannel(),model:this.model}},initSearchView:function(){this.sidebarView=new Cetabo.SearchView(this.getSearchConfiguration())},getSearchConfiguration:function(){return{el:"#"+this.enforceELId(this.find(".cmap-search")),channel:this.getChannel(),model:this.model}},initModel:function(){this.model=new Cetabo.MapModel(this.getDefaultModelState())},getDefaultModelState:function(){var a;return a=this.getChannel(),{readonly:this.isReadOnly(),channel:a}},initMapManager:function(){var a;a=this.getMapConfiguration(),this.mapManager=new Cetabo.MapManager(a)},getMapConfiguration:function(){var a;return a=this.enforceELId(this.find(".map-canvas")),{el:a,readonly:this.isReadOnly(),channel:this.getChannel(),baseURL:this.config.baseURL,scaleControl:this.model.get("scalecontrol")}},initStreetManager:function(){var a;a=this.getStreetConfiguration(),this.streetManager=new Cetabo.StreetManager(a)},getStreetConfiguration:function(){var a,b;return b=this.enforceELId(this.find(".street-canvas")),a=this.enforceELId(this.find(".street-canvas-error")),{el:b,errorEl:a,readonly:this.isReadOnly(),channel:this.getChannel(),baseURL:this.config.baseURL}},initDirectionManager:function(){var a;a=this.getDirectionConfiguration(),this.directionManger=new Cetabo.DirectionManager(a)},getDirectionConfiguration:function(){return{canvas:this.getElId(),readonly:this.isReadOnly(),channel:this.getChannel(),baseURL:this.config.baseURL}},getConfiguration:function(){return this.config},isReadOnly:function(){return!0},loadModel:function(a){var b,c;c=this,b=this.getChannel(),Cetabo.EventDistpatcher.use(b).trigger("backend.send",{content:{id:a},url:this.getLoadURL(),callback:{success:function(a){c.model.load(a),Cetabo.EventDistpatcher.use(b).trigger("map.load",c.model)}}})},getLoadURL:function(){return this.getConfiguration().url.load},onLoadMapCallback:function(a){var b,c,d;b=this.getChannel(),d=a.get("places");for(c in d)Cetabo.EventDistpatcher.use(b).trigger("place.add",d[c]),Cetabo.EventDistpatcher.use(b).trigger("place.update",d[c]);Cetabo.EventDistpatcher.use(b).trigger("styler.update",a.buildMapStyler()),this.isReadOnly()&&Cetabo.EventDistpatcher.use(b).trigger("map.updatesize",a.get("width"),a.get("height")),Cetabo.EventDistpatcher.use(b).trigger("map.updatezoom",parseInt(a.get("zoom"))),Cetabo.EventDistpatcher.use(b).trigger("map.updatedragging",a.get("dragging")),Cetabo.EventDistpatcher.use(b).trigger("map.updatedoubleclickzoom",a.get("doubleclickzoom")),Cetabo.EventDistpatcher.use(b).trigger("map.updatescrollwellzoom",a.get("scrollwellzoom")),Cetabo.EventDistpatcher.use(b).trigger("map.updatezoomcontrol",a.get("zoomcontrol")),Cetabo.EventDistpatcher.use(b).trigger("map.updatezoomcontrolposition",a.get("zoomcontrolposition")),Cetabo.EventDistpatcher.use(b).trigger("map.updatestreetviewcontrol",a.get("streetviewcontrol")),Cetabo.EventDistpatcher.use(b).trigger("map.updatestreetviewcontrolposition",a.get("streetviewcontrolposition")),Cetabo.EventDistpatcher.use(b).trigger("map.updatepancontrol",a.get("pancontrol")),Cetabo.EventDistpatcher.use(b).trigger("map.updatepancontrolposition",a.get("pancontrolposition")),Cetabo.EventDistpatcher.use(b).trigger("map.updatemaptypecontrol",a.get("maptypecontrol")),Cetabo.EventDistpatcher.use(b).trigger("map.updatemaptypecontrolposition",a.get("maptypecontrolposition")),Cetabo.EventDistpatcher.use(b).trigger("map.updatescalecontrol",a.get("scalecontrol")),Cetabo.EventDistpatcher.use(b).trigger("direction.stateupdate",a.get("enabledirection")),Cetabo.EventDistpatcher.use(b).trigger("tags.stateupdate",a.get("enabletags")),Cetabo.EventDistpatcher.use(b).trigger("places.stateupdate",a.get("enableplaces")),Cetabo.EventDistpatcher.use(b).trigger("map.updatezoomrange",a.get("zoomrange")),Cetabo.EventDistpatcher.use(b).trigger("map.updatecenter",a.get("lat"),a.get("lng")),Cetabo.EventDistpatcher.use(b).trigger("map.updatetype",a.get("type")),Cetabo.EventDistpatcher.use(b).trigger("street.updateposition",a.get("streetlat"),a.get("streetlng")),Cetabo.EventDistpatcher.use(b).trigger("street.updatepov",{heading:a.get("heading"),pitch:a.get("pitch")}),Cetabo.EventDistpatcher.use(b).trigger("map.updatemode",a.get("mode")),Cetabo.EventDistpatcher.use(b).trigger("place.cluster",a.get("clustering")),Cetabo.EventDistpatcher.use(b).trigger("overlay.updated",a),this.isReadOnly()&&Cetabo.EventDistpatcher.use(b).trigger("screen.stateupdate",a.get("startfullscreen")),Cetabo.EventDistpatcher.use(b).trigger("view.updatefullscreen",a.get("enablefullscreen")),Cetabo.EventDistpatcher.use(b).trigger("view.updatesearch",a.get("enableaddressearch")),Cetabo.EventDistpatcher.use(b).trigger("map.loaded")},onResizeFullscreen:function(a,b){var c;c=this.getChannel(),Cetabo.EventDistpatcher.use(c).trigger("screen.updatesize",a,b)},getOriginalSize:function(){return{width:this.model.get("width"),height:this.model.get("height")}},onResizeOriginalSize:function(a,b){var c;c=this.getChannel(),Cetabo.EventDistpatcher.use(c).trigger("screen.updatesize",a,b)},onUpdateMapSize:function(a,b){this.isReadOnly()&&jQuery("#"+this.getElId()).width(a).height(b)},onScreenResolutionChanged:function(){this.toggleSidebarMode()},onChangeMode:function(){this.toggleSidebarMode()},toggleSidebarMode:function(){var a,b,c;a=this.isReadOnly()?this.findParent(".cmap-container"):this.find(".cmap-container"),b=this.model.get("mode")===google.maps.MapMode.STREET,c=this.find(".map-canvas").width(),480>c||b?a.addClass("cmap-mob-wrap"):a.removeClass("cmap-mob-wrap")},onUpdateFullscreen:function(a){this.setFullscreen(a)},onEnableFullscreen:function(a){a?this.find(".cmap-fullscreen").show():this.find(".cmap-fullscreen").hide()},onEnableSearch:function(a){a?this.find(".cmap-search").show():this.find(".cmap-search").hide()},setFullscreen:function(){this.isReadOnly()&&Cetabo.MapView.__super__.setFullscreen.apply(this,arguments)}})}.call(this);